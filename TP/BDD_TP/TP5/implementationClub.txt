-- CREATE SCHEMA club_sportif;
-- SET search_path TO club_sportif;


DROP TABLE STOCK;
DROP TABLE ENTRAINEMENT;
DROP TABLE ENTRAINEUR;
DROP TABLE MANIF;
DROP TABLE SALLE;
DROP TABLE EQUIPE;
DROP TABLE CATEGORIE;
DROP TABLE xGYMNASE;
DROP TABLE xGARDIEN;
DROP TABLE EQUIPEMENT;
DROP TABLE TRANCHE_HORAIRE;
DROP TABLE CLUB;
DROP TABLE SPORT;


CREATE TABLE EQUIPEMENT
(
	equipement_num INT,
	equipement_nom VARCHAR(50) NOT NULL CHECK( equipement_nom <> ''),
	PRIMARY KEY(equipement_num)
);

CREATE TABLE TRANCHE_HORAIRE
(
	TH_num INT,
	TH_jour VARCHAR(10) NOT NULL CHECK( TH_jour <> ''),
	TH_heure VARCHAR(20) NOT NULL CHECK( TH_heure <> ''),
	TH_semaine INT NOT NULL,
	PRIMARY KEY(TH_num)
);

CREATE TABLE SPORT
(
	sport_num INT,
	sport_nom VARCHAR(50) NOT NULL CHECK( sport_nom <> ''),
	PRIMARY KEY(sport_num)
);

CREATE TABLE CLUB
(
	club_num INT,
	club_nom VARCHAR(50) NOT NULL CHECK( club_nom <> ''),
	club_adresse VARCHAR(50),
	PRIMARY KEY(club_num)
);

CREATE TABLE xGARDIEN
(
	gardien_num INT,
	gardien_nom VARCHAR(50) NOT NULL CHECK( gardien_nom <> ''),
	gardien_adresse VARCHAR(50),
	PRIMARY KEY(gardien_num)
);

CREATE TABLE xGYMNASE
(
	gymnase_num INT,
	gymnase_nom VARCHAR(50) NOT NULL CHECK( gymnase_nom <> ''),
	gymnase_adresse VARCHAR(50),
	gardien_num INT,
	FOREIGN KEY(gardien_num) REFERENCES xGARDIEN (gardien_num),
	PRIMARY KEY(gymnase_num)
);

CREATE TABLE SALLE
(
	salle_num INT,
	salle_nom VARCHAR(50) NOT NULL CHECK( salle_nom <> ''),
	gymnase_num INT REFERENCES xGYMNASE ON DELETE CASCADE,
	PRIMARY KEY(salle_num)
);

CREATE TABLE CATEGORIE
(
	cat_num INT,
	cat_nom VARCHAR(50) NOT NULL CHECK( cat_nom <> '' AND(cat_nom = 'Junior' OR cat_nom = 'Senior' OR cat_nom = 'Veteran' OR cat_nom = 'Minor I' OR cat_nom = 'Minor II')) ,
	sport_num INT,
	FOREIGN KEY(sport_num) REFERENCES SPORT (sport_num),
	PRIMARY KEY(cat_num)
);

CREATE TABLE EQUIPE
(
	equipe_num INT,
	equipe_nom VARCHAR(50) NOT NULL CHECK( equipe_nom <> ''),
	cat_num INT,
	club_num INT,
	FOREIGN KEY(cat_num) REFERENCES CATEGORIE (cat_num),
	FOREIGN KEY(club_num) REFERENCES CLUB (club_num),
	PRIMARY KEY(equipe_num)
);

CREATE TABLE STOCK
(
	equipement_num INT,
	salle_num INT,
	stock_quantite INT,
	FOREIGN KEY(salle_num) REFERENCES SALLE (salle_num),
	FOREIGN KEY(equipement_num) REFERENCES EQUIPEMENT (equipement_num)
);

CREATE TABLE ENTRAINEMENT
(
	TH_num INT,
	salle_num INT,
	equipe_num INT, 
	entraineur_nom VARCHAR(50) NOT NULL CHECK( entraineur_nom <> ''), 
	nb_joueur INT DEFAULT 0,
	UNIQUE (TH_num,salle_num),
	FOREIGN KEY(salle_num) REFERENCES SALLE (salle_num),
	FOREIGN KEY(TH_num) REFERENCES TRANCHE_HORAIRE (TH_num),
	FOREIGN KEY(equipe_num) REFERENCES EQUIPE (equipe_num)
);

CREATE TABLE MANIF
(
	manif_num INT,
	manif_nom VARCHAR(50) NOT NULL,
	salle_num INT, 
	TH_num INT,
	UNIQUE (salle_num, TH_num),
	FOREIGN KEY(salle_num) REFERENCES SALLE (salle_num),
	FOREIGN KEY(TH_num) REFERENCES TRANCHE_HORAIRE (TH_num),
	PRIMARY KEY(manif_num)
);


INSERT INTO CLUB VALUES (1,'SPORTIF LAVALLOIS',NULL);
INSERT INTO CLUB VALUES (2,'ACB',NULL);
INSERT INTO CLUB VALUES (3,'TVC',NULL);
INSERT INTO CLUB VALUES (4,'PETITS LOUPS',NULL);
INSERT INTO CLUB VALUES (5,'MAMIE SPORTIVE',NULL);
INSERT INTO CLUB VALUES (6,'SMA',NULL);
INSERT INTO CLUB VALUES (7,'FIC',NULL);
INSERT INTO CLUB VALUES (8,'MVC',NULL);


INSERT INTO xGARDIEN VALUES (1,'Jacquard', NULL);
INSERT INTO xGARDIEN VALUES (2,'Terpin', NULL);
INSERT INTO xGARDIEN VALUES (3,'Azerty', NULL);


INSERT INTO xGYMNASE VALUES (1, 'Pierre de Coubertin', 'La Galicherie', (SELECT gardien_num FROM xGARDIEN WHERE gardien_nom = 'Jacquard'));
INSERT INTO xGYMNASE VALUES (2, 'Pierre Brossolette', 'Centre Ville', (SELECT gardien_num FROM xGARDIEN WHERE gardien_nom = 'Terpin'));
INSERT INTO xGYMNASE VALUES (3, 'Leo Lagrange', 'Rocqueville', (SELECT gardien_num FROM xGARDIEN WHERE gardien_nom = 'Azerty'));


INSERT INTO SALLE VALUES ( 512,'Dojo', (SELECT gymnase_num FROM xGYMNASE WHERE gymnase_nom = 'Pierre de Coubertin'));
INSERT INTO SALLE VALUES ( 515,'Marumba',(SELECT gymnase_num FROM xGYMNASE WHERE gymnase_nom = 'Pierre de Coubertin'));

INSERT INTO SALLE VALUES ( 214,'Tatami', (SELECT gymnase_num FROM xGYMNASE WHERE gymnase_nom = 'Pierre Brossolette'));

INSERT INTO SALLE VALUES ( 267,'Bingo', (SELECT gymnase_num FROM xGYMNASE WHERE gymnase_nom = 'Leo Lagrange'));
INSERT INTO SALLE VALUES ( 123,'Salle 1', (SELECT gymnase_num FROM xGYMNASE WHERE gymnase_nom = 'Leo Lagrange'));
INSERT INTO SALLE VALUES ( 124,'Salle 2', (SELECT gymnase_num FROM xGYMNASE WHERE gymnase_nom = 'Leo Lagrange'));


INSERT INTO SPORT VALUES (1,'Judo');
INSERT INTO SPORT VALUES (2,'Tennis');
INSERT INTO SPORT VALUES (3,'Football');
INSERT INTO SPORT VALUES (4,'BasketBall');
INSERT INTO SPORT VALUES (5,'Gymnastique');
INSERT INTO SPORT VALUES (6,'Handball');
INSERT INTO SPORT VALUES (7,'Preparation Physique');
INSERT INTO SPORT VALUES (8,'Table Tennis');
INSERT INTO SPORT VALUES (9,'VolleyBall');
INSERT INTO SPORT VALUES (10,'Badminton');


INSERT INTO CATEGORIE VALUES (1,'Junior',4);
INSERT INTO CATEGORIE VALUES (2,'Senior',4);
INSERT INTO CATEGORIE VALUES (3,'Veteran',4);
INSERT INTO CATEGORIE VALUES (4,'Junior',2);
INSERT INTO CATEGORIE VALUES (5,'Senior',2);
INSERT INTO CATEGORIE VALUES (6,'Veteran',2);
INSERT INTO CATEGORIE VALUES (7,'Minor I',1);
INSERT INTO CATEGORIE VALUES (8,'Minor II',1);
INSERT INTO CATEGORIE VALUES (9,'Junior',3);
INSERT INTO CATEGORIE VALUES (10,'Senior',3);
INSERT INTO CATEGORIE VALUES (11,'Veteran',3);
INSERT INTO CATEGORIE VALUES (12,'Junior',5);
INSERT INTO CATEGORIE VALUES (13,'Junior',5);
INSERT INTO CATEGORIE VALUES (14,'Senior',5);


INSERT INTO EQUIPE VALUES (1,'SC Minor I',7,1);
INSERT INTO EQUIPE VALUES (2,'SC Minor II',8,1);
INSERT INTO EQUIPE VALUES (4,'ACB Junior',4,2);
INSERT INTO EQUIPE VALUES (3,'ACB Senior',5,2);
INSERT INTO EQUIPE VALUES (11,'ACB Veteran',6,2);
INSERT INTO EQUIPE VALUES (5,'TVC Minor II',2,4);
INSERT INTO EQUIPE VALUES (6,'Les petits rouleurs',12,5);
INSERT INTO EQUIPE VALUES (7,'Les petits poussins',7,1);
INSERT INTO EQUIPE VALUES (8,'Jumping Senior',2,4);
INSERT INTO EQUIPE VALUES (9,'Volontary women',14,5);
INSERT INTO EQUIPE VALUES (10,'SMA Senior II',2,6);


INSERT INTO TRANCHE_HORAIRE VALUES (1,'Lundi','15:00-17:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (2,'Lundi','17:00-19:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (3,'Lundi','15:00-17:00',13);
INSERT INTO TRANCHE_HORAIRE VALUES (4,'Mardi','15:00-17:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (5,'Mardi','17:00-19:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (6,'Mardi','15:00-17:00',13);
INSERT INTO TRANCHE_HORAIRE VALUES (7,'Mercredi','15:00-17:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (8,'Mercredi','17:00-19:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (9,'Mercredi','15:00-17:00',13);
INSERT INTO TRANCHE_HORAIRE VALUES (10,'Jeudi' ,'15:00-17:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (11,'Jeudi','17:00-19:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (12,'Jeudi','15:00-17:00',13);
INSERT INTO TRANCHE_HORAIRE VALUES (13,'Vendredi','15:00-17:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (14,'Vendredi','17:00-19:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (15,'Vendredi','15:00-17:00',13);
INSERT INTO TRANCHE_HORAIRE VALUES (16,'Samedi','15:00-17:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (17,'Samedi','17:00-19:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (18,'Samedi','15:00-17:00',13);
INSERT INTO TRANCHE_HORAIRE VALUES (19,'Dimanche','15:00-17:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (20,'Dimanche','17:00-19:00',12);
INSERT INTO TRANCHE_HORAIRE VALUES (21,'Dimanche','15:00-17:00',13);


INSERT INTO ENTRAINEMENT VALUES (1,512,1,'Loic Dupont',5);
INSERT INTO ENTRAINEMENT VALUES (2,512,2,'Sophie Banot',12);
INSERT INTO ENTRAINEMENT VALUES (1,515,5,'Luc Marni',24);
INSERT INTO ENTRAINEMENT VALUES (4,515,4,'Clementine Pierrot',16);
INSERT INTO ENTRAINEMENT VALUES (5,123,8,'Jacques Santini',12);
INSERT INTO ENTRAINEMENT VALUES (3,515,5,'Luc Marni',NULL);


INSERT INTO MANIF VALUES (1,'Telethon',515,1);
INSERT INTO MANIF VALUES (2,'Marathon',515,10);
INSERT INTO MANIF VALUES (3,'Velethon',512,13);
INSERT INTO MANIF VALUES (4,'Festnoz',512,21);
INSERT INTO MANIF VALUES (5,'Noel',123,20);
INSERT INTO MANIF VALUES (6,'Fete',515,20);


CREATE TABLE ENTRAINEUR
(
	entraineur_num INT,
	entraineur_nom VARCHAR(50),
	entraineur_adresse VARCHAR(50),
	entraineur_telephone VARCHAR(50),
	PRIMARY KEY(entraineur_num)
);

INSERT INTO ENTRAINEUR VALUES (1,'Loic Dupont', 'Le Mans', '06-06-06-06-06');
INSERT INTO ENTRAINEUR VALUES (2,'Sophie Banot', 'La Rochelle', '06-04-43-65-25');
INSERT INTO ENTRAINEUR VALUES (3,'Luc Marni','Strasbourg', '06-18-92-21-07');
INSERT INTO ENTRAINEUR VALUES (4,'Clementine Pierrot','Paris','07-45-98-25-61');
INSERT INTO ENTRAINEUR VALUES (5,'Jacques Santini','Marseille','01-21-58-96-05');


ALTER TABLE ENTRAINEMENT ADD entraineur_num INT;
ALTER TABLE ENTRAINEMENT ADD CONSTRAINT entraineur_num FOREIGN KEY(entraineur_num) REFERENCES ENTRAINEUR (entraineur_num);

UPDATE ENTRAINEMENT SET entraineur_num =((SELECT ENTRAINEUR.entraineur_num FROM ENTRAINEUR WHERE ENTRAINEUR.entraineur_nom = ENTRAINEMENT.entraineur_nom)); 

ALTER TABLE ENTRAINEMENT DROP entraineur_nom;


CREATE TABLE SPORT_CO AS
		SELECT * FROM SPORT WHERE sport_nom IN ('Football','BasketBall','Handball');

ALTER TABLE SPORT_CO ADD nb_joueur INT CONSTRAINT nb_joueur DEFAULT 15;

DROP TABLE SPORT_CO;

